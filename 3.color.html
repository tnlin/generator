<html>
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>八仙塵爆事件-傷者資料查詢</title>
        <meta name="og:title" content="八仙塵爆事件-傷者資料查詢">
        <meta name="og:description" content="天佑台灣">
    <link rel='stylesheet prefetch' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
</head>
<style> body {font-family:Microsoft JhengHei;}</style>
<body>
        <div class="container" ng-app="myApp">
                <div class="col-md-12" ng-controller="myController as my">
                        <h1>八仙塵爆事件-傷者資料查詢 <a href="https://github.com/tnlin/color"><span class="btn btn-info">Source Code</span></a></h1>
                        <p class="alert alert-info">最後更新時間：{{my.datas.lastmodify}}，資料來源 北市府資訊局</p>
                        <div class="margin-bottom-10">
                                <input type="text" class="form-control" placeholder="請輸入「任意」關鍵字(EX:姓名、收治單位、救護檢傷)" ng-model="my.search" />
                        </div>
                        <br>
                        <span class="label label-success">已出院：{{success}}人</span>
                        <span class="label label-warning">未出院：{{warning}}人</span>
                        <br>
                        <div class="table-responsive">
                                <table class="table table-hover">
                                        <thead>
                                                <tr>
                                                        <th>收治單位</th>
                                                        <th>傷患資料</th>
                                                        <th>檢傷資訊</th>
                                                </tr>
                                        </thead>
                                        <tbody>
                                                <tr ng-repeat="data in my.datas.data | filter:my.search">
                                                        <td>
                                                                {{data['編號']}}<br>
                                                                <a href="https://www.google.com/maps?q={{ data['收治單位'] }}" target="_blank">{{ data['縣市別']}} <br>
                                                                {{data['收治單位']}}</a><br />
                                                        </td>
                                                        <td>{{data['姓名']}}<br>{{data['性別']}} {{data['年齡']}}<br>{{data['國籍']}}</td>
                                                        <td>醫療檢傷：{{data['醫療檢傷']}}<br>救護檢傷：{{data['救護檢傷']}}<br>檢傷編號：{{data['檢傷編號']}}
                                                                <h4>
                                                                  <span ng-switch="data['即時動向']">
                                                                        <span ng-switch-when="出院" class="label label-success">
                                                                           {{data['即時動向']}}
                                                                        </span>
                                                                        <span ng-switch-when="自動出院
(AAD)" class="label label-success">
                                                                           {{data['即時動向']}}
                                                                        </span>
                                                                        <span ng-switch-when="加護病房" class="label label-danger">
                                                                           {{data['即時動向']}}
                                                                        </span>
                                                                        <span ng-switch-default class="label label-primary">
                                                                           {{data['即時動向']}}
                                                                        </span>
                                                                  </span>
                                                                </h4>
                                                        </td>
                                                </tr>
                                        </tbody>
                                </table>
                        </div>
                </div>
        </div>
</body>
<script src="https://code.jquery.com/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.min.js'></script>
<script>
var app = angular.module('myApp', []).controller('myController', ['$scope', '$http', controller]);

function controller($scope, $http) {
    var vm = this;
        $scope.warning = 0;
    $scope.success = 0;
    vm.datas = [];
    vm.loadData = function () {
        $http.get('https://gist.githubusercontent.com/tony1223/098e45623c73274f7ae3/raw')
            .success(function (res) {
                        data = angular.fromJson(res);
            vm.datas = data
                        vm.datas.data.forEach(function(item) {
                          if (/出院/i.test(item['即時動向'])) {
                                $scope.success += 1;
                          } else {
                                $scope.warning += 1;
                          }
                        });
            $scope.$apply();
        });
    };
    vm.loadData();
}
</script>
</html>

